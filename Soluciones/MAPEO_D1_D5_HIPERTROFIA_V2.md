# ğŸ“… SISTEMA DE MAPEO D1-D5 - HIPERTROFIA V2

**VersiÃ³n:** 1.0
**Fecha:** 2025-11-17
**MetodologÃ­a:** Hipertrofia V2 (MindFeed)

---

## ğŸ¯ REGLA DE ORO

**El dÃ­a en que generas el plan se convierte en tu D1 (primera sesiÃ³n) y determina tu patrÃ³n semanal fijo para toda la rutina.**

---

## ğŸ“‹ CASOS DE MAPEO

### âœ… CASO 1: LUNES (sin problema)

**Disponibilidad:** Lunes a Viernes (no incluye sÃ¡bado nunca)

**PatrÃ³n fijo semanal:** Lun â†’ Mar â†’ MiÃ© â†’ Jue â†’ Vie

**Primera semana:**

- **Lunes (dÃ­a de generaciÃ³n):** D1 âœ… (primera sesiÃ³n HOY)
- Martes: D2
- MiÃ©rcoles: D3
- Jueves: D4
- Viernes: D5 â† completa el primer microciclo

**Segunda semana:**

- Lunes: D1 (repite patrÃ³n)
- Martes: D2
- MiÃ©rcoles: D3
- Jueves: D4
- Viernes: D5 â† completa el segundo microciclo

**Semana 8 final:**

- Lunes: D1 (sesiÃ³n 36)
- Martes: D2 (sesiÃ³n 37)
- MiÃ©rcoles: D3 (sesiÃ³n 38)
- Jueves: D4 (sesiÃ³n 39)
- **Viernes: D5 (sesiÃ³n 40 - FINALIZA)**

**Total:** 8 semanas completas, 40 sesiones

---

### âœ… CASO 2: MARTES CON SÃBADO

**Disponibilidad:** Martes a SÃ¡bado (incluye sÃ¡bado)

**PatrÃ³n fijo semanal:** Mar â†’ MiÃ© â†’ Jue â†’ Vie â†’ SÃ¡b

**Primera semana:**

- **Martes (dÃ­a de generaciÃ³n):** D1 âœ… (primera sesiÃ³n HOY)
- MiÃ©rcoles: D2
- Jueves: D3
- Viernes: D4
- SÃ¡bado: D5 â† completa el primer microciclo

**Segunda semana:**

- Lunes: âŒ descanso
- Martes: D1 (repite patrÃ³n)
- MiÃ©rcoles: D2
- Jueves: D3
- Viernes: D4
- SÃ¡bado: D5 â† completa el segundo microciclo

**Semana 8 final:**

- Martes: D1 (sesiÃ³n 36)
- MiÃ©rcoles: D2 (sesiÃ³n 37)
- Jueves: D3 (sesiÃ³n 38)
- Viernes: D4 (sesiÃ³n 39)
- **SÃ¡bado: D5 (sesiÃ³n 40 - FINALIZA)**

**Total:** 8 semanas completas, 40 sesiones

---

### ğŸ”§ CASO 3: MARTES SIN SÃBADO (A IMPLEMENTAR)

**Disponibilidad:** Lunes a Viernes (NO incluye sÃ¡bado)

**PatrÃ³n fijo semanal:** Mar â†’ MiÃ© â†’ Jue â†’ Vie â†’ **Lun** (salta fin de semana)

**Primera semana:**

- **Martes (dÃ­a de generaciÃ³n):** D1 âœ… (primera sesiÃ³n HOY)
- MiÃ©rcoles: D2
- Jueves: D3
- Viernes: D4
- SÃ¡bado/Domingo: âŒ descanso
- **Lunes (semana 2):** D5 â† completa el primer microciclo

**Segunda semana:**

- Lunes: D5 (de primera semana)
- **Martes:** D1 (nuevo microciclo)
- MiÃ©rcoles: D2
- Jueves: D3
- Viernes: D4
- SÃ¡bado/Domingo: âŒ descanso

**Tercera semana:**

- **Lunes:** D5 (de segunda semana)
- Martes: D1
- MiÃ©rcoles: D2
- Jueves: D3
- Viernes: D4

**Semana 9 final:**

- **Lunes: D5 (sesiÃ³n 40 - FINALIZA)**

**Total:** 8 semanas + 1 lunes extra, 40 sesiones

**Mapeo permanente:**

```
D1 = Martes
D2 = MiÃ©rcoles
D3 = Jueves
D4 = Viernes
D5 = Lunes
```

---

### ğŸ”§ CASO 4: MIÃ‰RCOLES CON SÃBADO

**Disponibilidad:** MiÃ©rcoles a SÃ¡bado + Lunes (incluye sÃ¡bado)

**PatrÃ³n fijo semanal:** MiÃ© â†’ Jue â†’ Vie â†’ SÃ¡b â†’ Lun

**Primera semana:**

- **MiÃ©rcoles (dÃ­a de generaciÃ³n):** D1 âœ… (primera sesiÃ³n HOY)
- Jueves: D2
- Viernes: D3
- SÃ¡bado: D4
- Domingo: âŒ descanso
- **Lunes (semana 2):** D5 â† completa el primer microciclo

**Segunda semana:**

- Lunes: D5 (de primera semana)
- Martes: âŒ descanso
- **MiÃ©rcoles:** D1 (nuevo microciclo)
- Jueves: D2
- Viernes: D3
- SÃ¡bado: D4

**Tercera semana:**

- **Lunes:** D5 (de segunda semana)
- Martes: âŒ descanso
- MiÃ©rcoles: D1
- Jueves: D2
- Viernes: D3
- SÃ¡bado: D4

**Semana 9 final:**

- **Lunes: D5 (sesiÃ³n 40 - FINALIZA)**

**Total:** 8 semanas + 1 lunes extra, 40 sesiones

**Mapeo permanente:**

```
D1 = MiÃ©rcoles
D2 = Jueves
D3 = Viernes
D4 = SÃ¡bado
D5 = Lunes
```

---

### ğŸ”§ CASO 5: MIÃ‰RCOLES SIN SÃBADO (A IMPLEMENTAR)

**Disponibilidad:** Lunes a Viernes (NO incluye sÃ¡bado)

**PatrÃ³n fijo semanal:** MiÃ© â†’ Jue â†’ Vie â†’ **Lun** â†’ **Mar** (salta fin de semana)

**Primera semana:**

- **MiÃ©rcoles (dÃ­a de generaciÃ³n):** D1 âœ… (primera sesiÃ³n HOY)
- Jueves: D2
- Viernes: D3
- SÃ¡bado/Domingo: âŒ descanso
- **Lunes (semana 2):** D4
- **Martes (semana 2):** D5 â† completa el primer microciclo

**Segunda semana:**

- Lunes: D4 (de primera semana)
- Martes: D5 (de primera semana)
- **MiÃ©rcoles:** D1 (nuevo microciclo)
- Jueves: D2
- Viernes: D3
- SÃ¡bado/Domingo: âŒ descanso

**Tercera semana:**

- **Lunes:** D4 (de segunda semana)
- **Martes:** D5 (de segunda semana)
- MiÃ©rcoles: D1
- Jueves: D2
- Viernes: D3

**Semana 9 final:**

- Lunes: D4 (sesiÃ³n 39)
- **Martes: D5 (sesiÃ³n 40 - FINALIZA)**

**Total:** 8 semanas + 2 dÃ­as extra, 40 sesiones

**Mapeo permanente:**

```
D1 = MiÃ©rcoles
D2 = Jueves
D3 = Viernes
D4 = Lunes
D5 = Martes
```

---

### ğŸ”§ CASO 6: JUEVES CON SÃBADO

**Disponibilidad:** Jueves a SÃ¡bado + Lunes a Martes (incluye sÃ¡bado)

**PatrÃ³n fijo semanal:** Jue â†’ Vie â†’ SÃ¡b â†’ Lun â†’ Mar

**Primera semana:**

- **Jueves (dÃ­a de generaciÃ³n):** D1 âœ… (primera sesiÃ³n HOY)
- Viernes: D2
- SÃ¡bado: D3
- Domingo: âŒ descanso
- **Lunes (semana 2):** D4
- **Martes (semana 2):** D5 â† completa el primer microciclo

**Segunda semana:**

- Lunes: D4 (de primera semana)
- Martes: D5 (de primera semana)
- MiÃ©rcoles: âŒ descanso
- **Jueves:** D1 (nuevo microciclo)
- Viernes: D2
- SÃ¡bado: D3

**Tercera semana:**

- **Lunes:** D4 (de segunda semana)
- **Martes:** D5 (de segunda semana)
- MiÃ©rcoles: âŒ descanso
- Jueves: D1
- Viernes: D2
- SÃ¡bado: D3

**Semana 9 final:**

- Lunes: D4 (sesiÃ³n 39)
- **Martes: D5 (sesiÃ³n 40 - FINALIZA)**

**Total:** 8 semanas + 2 dÃ­as extra, 40 sesiones

**Mapeo permanente:**

```
D1 = Jueves
D2 = Viernes
D3 = SÃ¡bado
D4 = Lunes
D5 = Martes
```

---

### ğŸ”§ CASO 7: JUEVES SIN SÃBADO (A IMPLEMENTAR)

**Disponibilidad:** Lunes a Viernes (NO incluye sÃ¡bado)

**PatrÃ³n fijo semanal:** Jue â†’ Vie â†’ **Lun** â†’ **Mar** â†’ **MiÃ©** (salta fin de semana)

**Primera semana:**

- **Jueves (dÃ­a de generaciÃ³n):** D1 âœ… (primera sesiÃ³n HOY)
- Viernes: D2
- SÃ¡bado/Domingo: âŒ descanso
- **Lunes (semana 2):** D3
- **Martes (semana 2):** D4
- **MiÃ©rcoles (semana 2):** D5 â† completa el primer microciclo

**Segunda semana:**

- Lunes: D3 (de primera semana)
- Martes: D4 (de primera semana)
- MiÃ©rcoles: D5 (de primera semana)
- **Jueves:** D1 (nuevo microciclo)
- Viernes: D2
- SÃ¡bado/Domingo: âŒ descanso

**Tercera semana:**

- **Lunes:** D3 (de segunda semana)
- **Martes:** D4 (de segunda semana)
- **MiÃ©rcoles:** D5 (de segunda semana)
- Jueves: D1
- Viernes: D2

**Semana 9 final:**

- Lunes: D3 (sesiÃ³n 38)
- Martes: D4 (sesiÃ³n 39)
- **MiÃ©rcoles: D5 (sesiÃ³n 40 - FINALIZA)**

**Total:** 8 semanas + 3 dÃ­as extra, 40 sesiones

**Mapeo permanente:**

```
D1 = Jueves
D2 = Viernes
D3 = Lunes
D4 = Martes
D5 = MiÃ©rcoles
```

---

## ğŸ“Š TABLA RESUMEN

| DÃ­a de inicio | Incluye sÃ¡bado | PatrÃ³n fijo semanal     | SesiÃ³n 40 finaliza en | Semanas totales | Estado actual    |
| ------------- | -------------- | ----------------------- | --------------------- | --------------- | ---------------- |
| **Lunes**     | No (nunca)     | Lun-Mar-MiÃ©-Jue-Vie     | Viernes sem 8         | 8 semanas       | âœ… Funcionando   |
| **Martes**    | SÃ­             | Mar-MiÃ©-Jue-Vie-SÃ¡b     | SÃ¡bado sem 8          | 8 semanas       | âœ… Funcionando   |
| **Martes**    | No             | **Mar-MiÃ©-Jue-Vie-Lun** | Lunes sem 9           | 8 sem + 1 dÃ­a   | ğŸ”§ A implementar |
| **MiÃ©rcoles** | SÃ­             | MiÃ©-Jue-Vie-SÃ¡b-Lun     | Lunes sem 9           | 8 sem + 1 dÃ­a   | âœ… Funcionando   |
| **MiÃ©rcoles** | No             | **MiÃ©-Jue-Vie-Lun-Mar** | Martes sem 9          | 8 sem + 2 dÃ­as  | ğŸ”§ A implementar |
| **Jueves**    | SÃ­             | Jue-Vie-SÃ¡b-Lun-Mar     | Martes sem 9          | 8 sem + 2 dÃ­as  | âœ… Funcionando   |
| **Jueves**    | No             | **Jue-Vie-Lun-Mar-MiÃ©** | MiÃ©rcoles sem 9       | 8 sem + 3 dÃ­as  | ğŸ”§ A implementar |

---

## ğŸ”§ IMPLEMENTACIÃ“N NECESARIA

### Problema Actual

El cÃ³digo actual, cuando detecta **Martes/MiÃ©rcoles/Jueves SIN sÃ¡bado**, hace lo siguiente:

```javascript
// âŒ COMPORTAMIENTO ACTUAL (INCORRECTO)
if (startDay >= 2 && startDay <= 4 && !includeSaturdays) {
  // Salta al prÃ³ximo lunes
  adjustedStartDate = getNextDayOfWeek(startDate, 1); // 1 = Lunes
  // Resultado: D1=Lun, D2=Mar, D3=MiÃ©, D4=Jue, D5=Vie
}
```

**Problema:** El usuario que genera el plan un **martes** tiene que esperar hasta el **lunes siguiente** para empezar a entrenar.

### SoluciÃ³n Requerida

```javascript
// âœ… COMPORTAMIENTO CORRECTO (A IMPLEMENTAR)
if (startDay >= 2 && startDay <= 4 && !includeSaturdays) {
  // El dÃ­a de generaciÃ³n ES el D1
  // Crear patrÃ³n que salta el fin de semana

  if (startDay === 2) {
    // Martes
    // PatrÃ³n: Mar-MiÃ©-Jue-Vie-Lun
    cycleDayMapping = {
      D1: "Martes",
      D2: "MiÃ©rcoles",
      D3: "Jueves",
      D4: "Viernes",
      D5: "Lunes",
    };
  } else if (startDay === 3) {
    // MiÃ©rcoles
    // PatrÃ³n: MiÃ©-Jue-Vie-Lun-Mar
    cycleDayMapping = {
      D1: "MiÃ©rcoles",
      D2: "Jueves",
      D3: "Viernes",
      D4: "Lunes",
      D5: "Martes",
    };
  } else if (startDay === 4) {
    // Jueves
    // PatrÃ³n: Jue-Vie-Lun-Mar-MiÃ©
    cycleDayMapping = {
      D1: "Jueves",
      D2: "Viernes",
      D3: "Lunes",
      D4: "Martes",
      D5: "MiÃ©rcoles",
    };
  }
}
```

---

## âœ… VALIDACIÃ“N

### Criterios de Ã©xito:

1. **Primera sesiÃ³n HOY:** Si genero el plan hoy (cualquier dÃ­a), puedo entrenar HOY mismo (D1)
2. **PatrÃ³n consistente:** El mapeo D1-D5 se mantiene fijo durante toda la rutina (40 sesiones)
3. **Microciclos correctos:** Cada 5 sesiones completo un microciclo (D5 â†’ D1 activa progresiÃ³n)
4. **Fin de semana respetado:** Si NO incluyo sÃ¡bado, salto sÃ¡bado/domingo automÃ¡ticamente
5. **40 sesiones totales:** Independientemente del dÃ­a de inicio, siempre 40 sesiones en 8+ semanas

### Casos de prueba:

```javascript
// Test 1: Martes sin sÃ¡bado
startDate = new Date("2024-11-19"); // Martes
includeSaturdays = false;
// Esperado: D1=Mar, D2=MiÃ©, D3=Jue, D4=Vie, D5=Lun
// SesiÃ³n 1 = 2024-11-19 (Martes)
// SesiÃ³n 5 = 2024-11-25 (Lunes siguiente)
// SesiÃ³n 40 = Lunes semana 9

// Test 2: MiÃ©rcoles sin sÃ¡bado
startDate = new Date("2024-11-20"); // MiÃ©rcoles
includeSaturdays = false;
// Esperado: D1=MiÃ©, D2=Jue, D3=Vie, D4=Lun, D5=Mar
// SesiÃ³n 1 = 2024-11-20 (MiÃ©rcoles)
// SesiÃ³n 5 = 2024-11-26 (Martes siguiente)
// SesiÃ³n 40 = Martes semana 9

// Test 3: Jueves sin sÃ¡bado
startDate = new Date("2024-11-21"); // Jueves
includeSaturdays = false;
// Esperado: D1=Jue, D2=Vie, D3=Lun, D4=Mar, D5=MiÃ©
// SesiÃ³n 1 = 2024-11-21 (Jueves)
// SesiÃ³n 5 = 2024-11-27 (MiÃ©rcoles siguiente)
// SesiÃ³n 40 = MiÃ©rcoles semana 9
```

---

## ğŸ“ NOTAS IMPORTANTES

1. **Consistencia en BD:** El mapeo D1-D5 â†’ dÃ­as reales se guarda en `app.plan_start_config` tabla (`first_week_pattern`)
2. **Motor de ciclo:** La funciÃ³n `advance_cycle_day()` usa el mapeo guardado, NO dÃ­as calendario
3. **ProgresiÃ³n:** Al completar D5 (sesiÃ³n 5, 10, 15...), se activa `apply_microcycle_progression()` automÃ¡ticamente
4. **Re-entrada:** Si el usuario cierra la app y vuelve, el motor debe continuar desde el mismo patrÃ³n (ej: si D1=Martes, siempre serÃ¡ martes)

---

**Documentado por:** Claude Code
**VersiÃ³n del documento:** 1.0
